<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buscador de Streams M3U8</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 20px;
        text-align: center;
    }
    input {
        width: 85%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #888;
        font-size: 16px;
    }
    button {
        padding: 12px 20px;
        margin-top: 10px;
        background: #2b4c7e;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
    }
    button:hover {
        background: #1f3656;
    }

    #resultados div {
        background: white;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        border-left: 5px solid #2b4c7e;
        word-wrap: break-word;
    }

    video {
        width: 90%;
        max-width: 600px;
        margin-top: 20px;
        background: black;
        border-radius: 10px;
    }

    /* Bot√≥n flotante cuando autoplay est√° bloqueado */
    .play-btn {
        padding: 12px 20px;
        background: #2b4c7e;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
        margin-top: 10px;
    }
</style>
</head>

<body>

<h2>üîç Buscador de Streams M3U8</h2>
<p>Ingresa una URL y detectar√° autom√°ticamente cualquier <strong>.m3u8</strong> o video oculto.</p>

<input type="text" id="urlInput" placeholder="Ingresa la URL de la p√°gina">
<br>
<button onclick="buscarStreams()">Buscar streams</button>

<h3>Resultados:</h3>
<div id="resultados"></div>

<h3>Reproductor:</h3>
<video id="player" controls></video>

<script>

// üîé Buscar streams en la p√°gina ingresada
async function buscarStreams() {
    const url = document.getElementById("urlInput").value.trim();
    const caja = document.getElementById("resultados");
    caja.innerHTML = "Buscando...";

    try {
        const res = await fetch("https://corsproxy.io/?" + url);
        const html = await res.text();

        const encontrados = [];

        // Buscar URLs .m3u8
        const regex = /(https?:\/\/[^\s"'<>]+\.m3u8)/g;
        let match;
        while ((match = regex.exec(html)) !== null) {
            encontrados.push(match[1]);
        }

        // Buscar MP4 / MKV / TS
        const regexVideos = /(https?:\/\/[^\s"'<>]+\.(mp4|mkv|ts))/g;
        while ((match = regexVideos.exec(html)) !== null) {
            encontrados.push(match[0]);
        }

        // Mostrar resultados
        if (encontrados.length === 0) {
            caja.innerHTML = "‚ùå No se encontraron streams.";
            return;
        }

        caja.innerHTML = "";
        encontrados.forEach(url => {
            let div = document.createElement("div");
            div.innerHTML = `${url} <br><button onclick="reproducir('${url}')">‚ñ∂ Reproducir</button>`;
            caja.appendChild(div);
        });

    } catch (e) {
        document.getElementById("resultados").innerHTML = "‚ùå Error al cargar la p√°gina.";
    }
}

// üé¨ Reproducir autom√°ticamente con fallback a bot√≥n
async function reproducir(url) {
    const video = document.getElementById("player");
    video.src = "";
    video.muted = true; // autoplay permitido en muchos navegadores

    // Si es M3U8 ‚Üí usar HLS.js
    if (url.includes(".m3u8")) {
        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
        } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
            video.src = url;
        }
    } else {
        video.src = url;
    }

    // Intentar autoplay
    try {
        await video.play();
        console.log("Autoplay OK");
    } catch (e) {
        console.log("Autoplay bloqueado");

        mostrarBoton(video);
    }
}

// üëÜ Mostrar bot√≥n de "Play" cuando autoplay es bloqueado
function mostrarBoton(video) {
    let btn = document.createElement("button");
    btn.textContent = "‚ñ∂ Iniciar reproducci√≥n";
    btn.className = "play-btn";

    btn.onclick = async () => {
        video.muted = false;
        await video.play();
        btn.remove();
    };

    video.insertAdjacentElement("afterend", btn);
}

</script>

</body>
</html>
